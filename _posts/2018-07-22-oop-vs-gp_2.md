---
layout: post
title: 从抽象谈面向对象与泛型编程 part.2 - 泛型编程的抽象
categories: moderncpp
---

## 1. 前言
上一篇浅讨了OOP中抽象常用的方法，而这一篇的内容，主要是对《数学与泛型编程》，后文简称MGP，中部分内容的小结。这本著作有相当多的篇幅，是对数论基础的讨论。其中的一条主线，就是最大公约数(GCD)算法的探讨。GCD算法推广的过程，演绎出很多数学中常用的抽象方法。而GP的抽象从一个具体的算法或者业务出发，抽象出一个适用于一个类型集合的外观，这个过程与数学定理的推广过程很类似。所以这一篇，我们将以最大公约数算法的推广作为主线，来探讨一些泛型编程中的抽象。

## 2. 最大公约数算法
GCD是数论的基础，可以说绝大部分数论的定理都是基于GCD推导出来的，而整个数论的发展历史就是一个推广GCD算法的历史。我们先刨除掉MGP中对优化GCD算法的讨论，把目光聚焦在GCD的推广上，所以我们选择了一个性能不是最优，但是实现上较为直观和突出我们抽象过程的版本。先来看看我们常见的正整数的GCD版本：
```cpp
uint32_t gcd(uin32_t a, uint32_t b) {
    while(b != 0) {
        a = a % b;
        std::swap(a, b);
    }
    return a;
}
```
这里有一个不严谨的地方，就是uint32_t是32位无符号整形变量，它的取值范围无法映射到整个非负整数的集合。但是对于gcd算法而言，原则上是不会出现算法溢出的，所以这里我们忽略溢出带来的问题。

首先，算法很简单，这是一个辗转求余的过程。数论的研究是要把它推广到适应更广泛的对象，而对于程序的实现而言，就是要推广它能够适应更多的类型。添加一个支持64位整数的版本，利用函数重载也很容易：
```cpp
uint64_t gcd(uint64_t a, uint64_t b) {
    while(b != 0) {
        a = a % b;
        std::swap(a, b);
    }
    return a;
}
```

## 3. 推广到有符号的整数
GCD早在古希腊，毕达哥斯拉学派中，就有了很深的研究。古希腊时代，人们还没有抽象出整数这个数学工具。数学工具还是以某个单位长度的绳子作为基础的时候，甚至连零的概念都没有，实际上在GCD原型中也未使用到零的概念。那段历史中，测量问题都是一个比较复杂的问题，例如探寻两条绳子的最大公尺量绳子的长度。
```cpp
line_segment gcd(line_segment a, line_segment b) {
    while(a != b) {
        a = remainder(a, b);
        std::swap(a, b);
    }
    return a;
}
```
借助这个原始版本的思想，当我们把GCD从非负整数推广到整个整数集合的时候，其实是如何对负整数求余操作的定义。如果把全体整数列在一条直线上，把每个整数i看作是一个从0出发，以1位单位，长度为i的有向线段。那么负整数的度量，就是它的长度了。我们把GCD推广到整数的方法，就是把对数求余变成对数的度量进行求余。
```cpp
int gcd(int a, int b) {
    a = std::abs(a);
    b = std::abs(b);
    while(b != 0) {
        a = a % b;
        std::swap(a, b);
    }
    return a;
}
```
当然，我们目前所使用的计算机，是可以使用对负数取模操作来计算余数的，实际上我们可以一行代码都不需要修改。
```cpp
int gcd(int a, int b) {
    while(b != 0) {
        a = a % b;
        std::swap(a, b);
    }
    return a;
}
```

## 4. 统一的外观
我们之前的几份GCD的实现，除了类型不同，几乎完全一样。于是，我们使用C++的模板技术，把这些都统一起来。
```cpp
template <typename T>
T gcd(T a, T b) {
    while(b != 0) {
        a = a % b;
        std::swap(a, b);
    }
}
```
这个版本的GCD就可以处理所有全部的整形了，但它也只能处理整形。原因就是我们使用了取模操作来计算余数，这个只能对整形数据求余，但对其他整数类型的数据无效，例如高斯整数。

高斯整数是形如x = m + in的整数，它有实部和虚部两个部分。推广GCD到高斯整数，